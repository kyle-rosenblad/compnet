<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The 'compnet' workflow • compnet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The 'compnet' workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">compnet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/compnet_workflow.html">The 'compnet' workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The 'compnet' workflow</h1>
                        <h4 data-toc-skip class="author"><a href="https://www.kylerosenblad.org/" class="external-link">Kyle Rosenblad</a></h4>
            
      

      <div class="d-none name"><code>compnet_workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kyle-rosenblad.github.io/compnet/">compnet</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The goal of a ‘compnet’ analysis is to quantify the effect of
competitive niche differentiation on community assembly for a group of
species. Competitive niche differentiation is a process whereby
functional dissimilarity between species promotes co-occurrence through
decreased overlap in resource use. Our input data will include a
species-by-site presence-absence matrix, as well as one or more
species-level variables (e.g., plant rooting depth) and/or variables
that only pertain to pairs of species (e.g., phylogenetic distance).</p>
<p>Before using ‘compnet’, we’ll translate our conceptual goal into a
quantitative “estimand” (i.e., something we’re aiming to estimate with
our model). Our estimand will be the effect of functional dissimilarity
between two species (as quantified via one or more traits; see above) on
the probability of co-occurrence. We will define the probability of
co-occurrence for a species pair as the probability that both species in
the pair co-occur at a given site, given that at least one of them is
present.</p>
<p>To estimate the effect of functional dissimilarity on co-occurrence
probabilities, we will use a regression model, in which the units of
analysis are species pairs. The response variable is the ratio of sites
containing both species to sites containing at least one of the two
species. For example, if 3 sites have Species A only, 2 sites have
Species B only, and 5 sites have both, the value of our response
variable would be 5/10=0.5 for this species pair. The predictor(s) can
encompass traits that we think might influence competitive niche
differentiation (e.g., plant species’ rooting depth), or pair-level
variables that could serve as a proxy for functional dissimilarity
(e.g., phylogenetic distance). We can include as many predictors as we
want. We’ll take advantage of this fact later, when we adjust for a
suspected confounding variable.</p>
<p>Using species pairs as units of analysis can cause problems for
typical regression models, and ‘compnet’ has tools for dealing with
these problems. When we build a regression model (e.g., a linear
regression, GLM, GLMM, etc.), we usually assume that the errors are
independently distributed. This assumption will likely be violated if we
model species pairs in a network without taking special steps. One
problem is that all pairs that include a given species might share
features in common. All ‘compnet’ models include components designed to
account for this kind of pattern. Additionally, there can be
higher-order patterns of non-independence among species pairs–e.g., “the
enemy of my enemy is my friend”. ‘compnet’ also has optional model
features for dealing with these higher-order patterns, which we will
demonstrate below. Further technical details are discussed in LINK
PREPRINT.</p>
<p>Let’s get started!</p>
</div>
<div class="section level2">
<h2 id="data-prep">Data prep<a class="anchor" aria-label="anchor" href="#data-prep"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">287</span><span class="op">)</span> <span class="co"># Ensure reproducibility</span></span>
<span></span>
<span><span class="co"># Load an example presence-absence matrix:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex_presabs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the first few rows and columns.</span></span>
<span><span class="co"># Rows are sites, and columns are species.</span></span>
<span><span class="co"># rownames and colnames are specified accordingly.</span></span>
<span><span class="va">ex_presabs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt;       sp1 sp2 sp3</span></span>
<span><span class="co">#&gt; site1   0   0   0</span></span>
<span><span class="co">#&gt; site2   0   0   0</span></span>
<span><span class="co">#&gt; site3   0   0   1</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load example species-level trait data:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex_traits"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the first few species.</span></span>
<span><span class="co"># Rows are species, and columns are traits.</span></span>
<span><span class="co"># rownames and colnames are specified accordingly.</span></span>
<span><span class="va">ex_traits</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;        ndtrait   domtrait ctrait</span></span>
<span><span class="co">#&gt; sp1 -0.9283953 -0.7888064      a</span></span>
<span><span class="co">#&gt; sp2 -0.1460273  0.3867546      c</span></span>
<span><span class="co">#&gt; sp3  0.7896740  1.6554773      a</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-with-one-species-trait">Model with one species trait<a class="anchor" aria-label="anchor" href="#model-with-one-species-trait"></a>
</h2>
<p>In the example data set, “ndtrait” is a trait that we think might
drive competitive niche differentiation (e.g., plant rooting depth), and
“domtrait” is a trait that we think might influence competitive ability
(e.g., plant height). “ctrait” is a categorical trait that we also
suspect of driving competitive niche differentiation. First we’ll build
a model with just “ndtrait”, as competitive niche differentiation is the
process we’re interested in.</p>
<p>If “ndtrait” is driving competitive niche differentiation, then we
expect species pairs who differ strongly in this trait to co-occur most
often. We’ll model the effect of “ndtrait” on co-occurrence probability
using a “distance interaction” term. In other words, for each species
pair, our model will use species A’s value of “ndtrait”, species B’s
value, and the absolute value of the difference between these two
values. This last term directly captures the effect we’re interested in,
which is called “heterophily” in the social sciences (i.e., things that
are different being attracted to each other). Social scientists often
model heterophily using a multiplicative interaction term instead of a
distance term. Here we use a distance interaction term because it
captures certain features of the competitive niche differentiation
process that multiplicative interaction terms can’t represent. (We’ll
see an example later.) However, multiplicative interaction terms can
provide other advantages (which we’ll also note below). To use a
multiplicative interaction term, just use ‘spvars_multi_int’ instead of
‘spvars_dist_int’ in the example code.</p>
<p>Stan, the statistical software under the hood, uses an algorithm
called NUTS to estimate our results for us. If we don’t let NUTS run for
enough iterations, we can’t trust our results. Stan will tell us if we
didn’t let our model run long enough, and it will provide web links to
help resources.</p>
<p>Before we try to build a good model, let’s deliberately tell NUTS to
do a very small number of iterations so we can see what those warnings
look like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shortrun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>                  spvars_dist_int<span class="op">=</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ndtrait"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                  warmup<span class="op">=</span><span class="fl">100</span>,</span>
<span>                  iter<span class="op">=</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'srm_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000123 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.23 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: WARNING: There aren't enough warmup iterations to fit the</span></span>
<span><span class="co">#&gt; Chain 1:          three stages of adaptation as currently configured.</span></span>
<span><span class="co">#&gt; Chain 1:          Reducing each adaptation stage to 15%/75%/10% of</span></span>
<span><span class="co">#&gt; Chain 1:          the given number of warmup iterations:</span></span>
<span><span class="co">#&gt; Chain 1:            init_buffer = 15</span></span>
<span><span class="co">#&gt; Chain 1:            adapt_window = 75</span></span>
<span><span class="co">#&gt; Chain 1:            term_buffer = 10</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:   1 / 200 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  20 / 200 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  40 / 200 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  60 / 200 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  80 / 200 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100 / 200 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 101 / 200 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 120 / 200 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 140 / 200 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 160 / 200 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 180 / 200 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 200 / 200 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.537 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                0.446 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                0.983 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is 1.13, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre></div>
<p>Now let’s build our first distance interaction model. We’ll call it
‘nd_0_mod’ because we’re using “ndtrait” as a predictor, and we’re using
the default ‘rank’ value of 0. (We’ll discuss the importance of this
rank = 0 decision shortly.) Sometimes, it takes a few tries at gradually
adjusting ‘warmup’ and ‘iter’ until you’re getting sufficient samples to
avoid warnings. I’ve already done that trial and error for this example
data set, so I’ll set ‘warmup’ and ‘iter’ at the sweet spot. (The
default settings will produce a longer run, but we don’t need that
here.)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd_0_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>        spvars_dist_int<span class="op">=</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ndtrait"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        warmup<span class="op">=</span><span class="fl">400</span>,</span>
<span>        iter<span class="op">=</span><span class="fl">1200</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'srm_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 8.3e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.83 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 1200 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  120 / 1200 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  240 / 1200 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  360 / 1200 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  401 / 1200 [ 33%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  520 / 1200 [ 43%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  640 / 1200 [ 53%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  760 / 1200 [ 63%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  880 / 1200 [ 73%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 1200 [ 83%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1120 / 1200 [ 93%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 1200 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 1.247 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                1.805 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                3.052 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span></code></pre></div>
<p>Before we try to interpret any results, let’s see if this model
provides a reasonable fit to the data. One of our main concerns with
network data is the multiple forms of non-independence that can arise
among observations, as discussed in the Introduction. Let’s use the
‘gofstats’ function to check how well our model accounts for these types
of non-independence in the example data set:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd_0_mod_gofstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gofstats.html">gofstats</a></span><span class="op">(</span><span class="va">nd_0_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Approx. completion</span></span>
<span><span class="co">#&gt; 25%</span></span>
<span><span class="co">#&gt; 50%</span></span>
<span><span class="co">#&gt; 75%</span></span>
<span><span class="co">#&gt; 100%</span></span>
<span><span class="va">nd_0_mod_gofstats</span></span>
<span><span class="co">#&gt; p.sd.rowmeans   p.cycle.dep </span></span>
<span><span class="co">#&gt;     0.0500000     0.6933333</span></span></code></pre></div>
<p>The first ‘p-value’, ‘p.sd.rowmeans’, tells us about patterns driven
by the fact that all species pairs including a given species share
features in common. Our ‘p.sd.rowmeans’ is low, which means when we
simulate data from the model we’ve built (‘gofstats’ did this in the
background), most of the simulated data have at least as much of this
kind of non-independence as the real data. That’s good; it means our
model is accounting for this form of non-independence among species
pairs. Anything that’s not super-high (around maybe 0.9ish or more) is
fine.</p>
<p>The second value, ‘p.cycle.dep’, tells us about higher-order
multi-species patterns. These can be abstract and challenging to
conceptualize. A good example is the saying, “the enemy of my enemy is
my friend”. Our ‘p.cycle.dep’ looks fine. It’s telling us that when we
simulate data from our model, around two thirds of the simulated data
sets have less high-order non-independence than the real data. We
wouldn’t usually worry about a ‘p.cycle.dep’ value like this, but for
the sake of illustration, let’s try increasing ‘rank’, which can be
helpful when ‘p.cycle.dep’ is problematically high. (Sometimes it can
also be helpful to switch from a distance interaction term to a
multiplicative interaction term, as discussed above.)</p>
<p>Also, notice I had to adjust ‘adapt_delta’ to make sampling to run
smoothly for this model. Adjusting ‘adapt_delta’ can help when Stan
gives warnings about “divergent transitions”. To see the warnings, you
could try running this model with ‘adapt_delta’ at an inadvisably low
level like 0.7.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd_1_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>        spvars_dist_int<span class="op">=</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ndtrait"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        rank<span class="op">=</span><span class="fl">1</span>,</span>
<span>        warmup<span class="op">=</span><span class="fl">300</span>,</span>
<span>        iter<span class="op">=</span><span class="fl">1000</span>,</span>
<span>        adapt_delta<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'ame_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000194 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.94 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 301 / 1000 [ 30%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 400 / 1000 [ 40%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 500 / 1000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 12.626 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                43.479 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                56.105 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 9 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 1 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="va">nd_1_mod_gofstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gofstats.html">gofstats</a></span><span class="op">(</span><span class="va">nd_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Approx. completion</span></span>
<span><span class="co">#&gt; 25%</span></span>
<span><span class="co">#&gt; 50%</span></span>
<span><span class="co">#&gt; 75%</span></span>
<span><span class="co">#&gt; 100%</span></span>
<span><span class="va">nd_1_mod_gofstats</span></span>
<span><span class="co">#&gt; p.sd.rowmeans   p.cycle.dep </span></span>
<span><span class="co">#&gt;    0.06666667    0.74000000</span></span></code></pre></div>
<p>Unsurprisingly, our gofstats look fine.</p>
<p>Before we move forward with this model, I recommend using the
‘DHARMa’ package to run some additional checks for model fit problems.
‘DHARMa’ doesn’t automatically install with ‘compnet’. If you have your
own model diagnostic workflow, you don’t need to use it.</p>
<p>We’ll use ‘DHARMa’ to check for overdispersion, quantile deviations,
uniformity, and zero inflation. You can read more about these issues and
their accompanying tests in the ‘DHARMa’ <a href="https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html" class="external-link">vignette</a>.
In general, we should be wary of tiny p-values, warning messages, and
visual patterns that deviate strongly from the expected patterns shown
in DHARMa’s output graphs. However, when you have a very large data set,
you can get tiny p-values even when the deviations from the expected
patterns are trivial. The diagnostic plots are key in these cases.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/" class="external-link">DHARMa</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')</span></span>
<span><span class="va">nd_1_mod_ppred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postpredsamp.html">postpredsamp</a></span><span class="op">(</span><span class="va">nd_1_mod</span><span class="op">)</span></span>
<span><span class="va">fpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">nd_1_mod_ppred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">nd_1_mod_dharma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">nd_1_mod_ppred</span>,</span>
<span>                                observedResponse <span class="op">=</span> <span class="va">nd_1_mod</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">both</span>,</span>
<span>                                fittedPredictedResponse <span class="op">=</span> <span class="va">fpr</span>,</span>
<span>                                integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html" class="external-link">testDispersion</a></span><span class="op">(</span><span class="va">nd_1_mod_dharma</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa nonparametric dispersion test via sd of residuals fitted vs.</span></span>
<span><span class="co">#&gt;  simulated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; dispersion = 0.82271, p-value = 0.5314</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testQuantiles.html" class="external-link">testQuantiles</a></span><span class="op">(</span><span class="va">nd_1_mod_dharma</span><span class="op">)</span></span></code></pre>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Test for location of quantiles via qgam</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  res</span></span>
<span><span class="co">#&gt; p-value = 0.583</span></span>
<span><span class="co">#&gt; alternative hypothesis: both</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testUniformity.html" class="external-link">testUniformity</a></span><span class="op">(</span><span class="va">nd_1_mod_dharma</span><span class="op">)</span></span></code></pre>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Asymptotic one-sample Kolmogorov-Smirnov test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput$scaledResiduals</span></span>
<span><span class="co">#&gt; D = 0.041727, p-value = 0.7225</span></span>
<span><span class="co">#&gt; alternative hypothesis: two-sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html" class="external-link">testZeroInflation</a></span><span class="op">(</span><span class="va">nd_1_mod_dharma</span><span class="op">)</span></span></code></pre>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-8-4.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa zero-inflation test via comparison to expected zeros with</span></span>
<span><span class="co">#&gt;  simulation under H0 = fitted model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; ratioObsSim = 1.012, p-value = 0.8029</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span></code></pre>
<p>This all looks fine. Going forward, to keep this vignette brief,
we’ll suppress the plots that accompany DHARMa tests, but I always
recommend checking the plots when you’re analyzing your own data.</p>
<p>Now let’s explore our results. First we’ll peek at the coefficients
for our predictors of interest:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarize_compnet.html">summarize_compnet</a></span><span class="op">(</span><span class="va">nd_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    Mean       2.5%      97.5%</span></span>
<span><span class="co">#&gt; intercept    -5.2410002 -6.1375622 -4.4895363</span></span>
<span><span class="co">#&gt; ndtrait_dist  0.8181314  0.5439445  1.1206381</span></span>
<span><span class="co">#&gt; ndtrait_sp    0.1212758 -0.1888162  0.4702241</span></span></code></pre></div>
<p>Let’s see those as violin plots:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fixedeff_violins.html">fixedeff_violins</a></span><span class="op">(</span><span class="va">nd_1_mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Now we’ll make a scatterplot, in which each point is a species pair.
The x axis will represent the trait value for “Species A” (A vs B is
arbitrary), and the y axis will represent co-occurrence probability.
We’ll include curves for the mean expectation with 95% credible
intervals. There will be multiple curves, each conditioned on a
different value of the focal trait for “Species B”. By default, the
scatter_interaction() function will generate the plot by conditioning on
the mean values of all other predictor variables pertaining to other
traits. (In this example model, “ndtrait” is the only trait.)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_interaction.html">scatter_interaction</a></span><span class="op">(</span><span class="va">nd_1_mod</span>, xvar<span class="op">=</span><span class="st">"ndtrait"</span>, xlabel<span class="op">=</span><span class="st">"ND Trait"</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>Cool! When Species B has a low value of “ndtrait”, the co-occurrence
probability increases with Species A’s “ndtrait” value. In other words,
if you have a low value of “ndtrait”, you’ll be more likely to co-occur
with other species that have high values. This pattern is consistent
with competitive niche differentiation. Similarly, when Species B’s
“ndtrait” value is high, co-occurrence probability decreases with
Species A’s value. Additionally, when Species B has an intermediate
value of “ndtrait”, co-occurrence probability is higher when Species A’s
value is at either extreme, with a dip in the middle. (This is the
pattern that multiplicative interaction models–as opposed to distance
interaction models–struggle to represent.) Overall, this plot
exemplifies the results we expect for a metacommunity shaped by
competitive niche differentiation.</p>
</div>
<div class="section level2">
<h2 id="model-with-two-traits">Model with two traits<a class="anchor" aria-label="anchor" href="#model-with-two-traits"></a>
</h2>
<p>When might we want to use multiple traits in the same model? For one,
we might want to use this strategy to deal with a suspected confounder
or “lurking variable”.</p>
<p>So far, we’ve just been using “ndtrait”, the trait that we think
drives competitive niche differentiation. In general, competitive niche
differentiation is expected to produce heterophily, a pattern whereby
species with different trait values co-occur most often. However, we’ve
got data for another trait called “domtrait”, which we think might
influence competitive ability. In general, competitive hierarchies
produce homophily–i.e., species co-occur most frequently with other
species of similar competitive ability. If there’s an association
between “ndtrait” and “domtrait”, then the homophily caused by
“domtrait” might be masking the heterophily caused by “ndtrait”. (To use
a plant-based example, maybe rooting depth drives niche differentiation,
plant height drives competitive ability, and the two traits are
positively associated.) Let’s see if there’s an association between the
two traits:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ndtrait"</span>, <span class="st">"domtrait"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            ndtrait  domtrait</span></span>
<span><span class="co">#&gt; ndtrait  1.0000000 0.4400044</span></span>
<span><span class="co">#&gt; domtrait 0.4400044 1.0000000</span></span></code></pre></div>
<p>There is. What can we do about it? Let’s include “domtrait” as a
covariate. Including a suspected confounder as a covariate can help us
in our quest for an unbiased estimate of the effect of “ndtrait” on
co-occurrence probabilities. (We can never do perfect causal inference
with observational data, but it’s worth getting as close as we can.
That’s another topic.)</p>
<p>Let’s try a new model using both “ndtrait” and “domtrait” with
distance interactions. We’ll start with rank=0. When the model’s built,
we’ll run gofstats() and ‘DHARMa’ checks.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd_dom_0_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>                        spvars_dist_int<span class="op">=</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ndtrait"</span>, <span class="st">"domtrait"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                        warmup<span class="op">=</span><span class="fl">400</span>,</span>
<span>                        iter<span class="op">=</span><span class="fl">1200</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'srm_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 8.5e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.85 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 1200 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  120 / 1200 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  240 / 1200 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  360 / 1200 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  401 / 1200 [ 33%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  520 / 1200 [ 43%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  640 / 1200 [ 53%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  760 / 1200 [ 63%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  880 / 1200 [ 73%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 1200 [ 83%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1120 / 1200 [ 93%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 1200 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 1.342 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                1.659 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                3.001 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span></span>
<span><span class="va">nd_dom_0_mod_gofstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gofstats.html">gofstats</a></span><span class="op">(</span><span class="va">nd_dom_0_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Approx. completion</span></span>
<span><span class="co">#&gt; 25%</span></span>
<span><span class="co">#&gt; 50%</span></span>
<span><span class="co">#&gt; 75%</span></span>
<span><span class="co">#&gt; 100%</span></span>
<span><span class="va">nd_dom_0_mod_gofstats</span></span>
<span><span class="co">#&gt; p.sd.rowmeans   p.cycle.dep </span></span>
<span><span class="co">#&gt;    0.07666667    0.86666667</span></span>
<span></span>
<span><span class="va">nd_dom_0_mod_ppred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postpredsamp.html">postpredsamp</a></span><span class="op">(</span><span class="va">nd_dom_0_mod</span><span class="op">)</span></span>
<span><span class="va">fpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">nd_dom_0_mod_ppred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">nd_dom_0_mod_dharma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">nd_dom_0_mod_ppred</span>,</span>
<span>                                observedResponse <span class="op">=</span> <span class="va">nd_dom_0_mod</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">both</span>,</span>
<span>                                fittedPredictedResponse <span class="op">=</span> <span class="va">fpr</span>,</span>
<span>                                integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html" class="external-link">testDispersion</a></span><span class="op">(</span><span class="va">nd_dom_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa nonparametric dispersion test via sd of residuals fitted vs.</span></span>
<span><span class="co">#&gt;  simulated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; dispersion = 1.828, p-value = 0.0125</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testQuantiles.html" class="external-link">testQuantiles</a></span><span class="op">(</span><span class="va">nd_dom_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Test for location of quantiles via qgam</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  nd_dom_0_mod_dharma</span></span>
<span><span class="co">#&gt; p-value = 0.8364</span></span>
<span><span class="co">#&gt; alternative hypothesis: both</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testUniformity.html" class="external-link">testUniformity</a></span><span class="op">(</span><span class="va">nd_dom_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Asymptotic one-sample Kolmogorov-Smirnov test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput$scaledResiduals</span></span>
<span><span class="co">#&gt; D = 0.037988, p-value = 0.8206</span></span>
<span><span class="co">#&gt; alternative hypothesis: two-sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html" class="external-link">testZeroInflation</a></span><span class="op">(</span><span class="va">nd_dom_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa zero-inflation test via comparison to expected zeros with</span></span>
<span><span class="co">#&gt;  simulation under H0 = fitted model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; ratioObsSim = 1.0151, p-value = 0.775</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span></code></pre></div>
<p>We’ve got some issues with high-order non-independence,
overdispersion, and quantile deviations. Let’s try again with ‘rank’ =
1.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd_dom_1_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>                        spvars_dist_int<span class="op">=</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ndtrait"</span>, <span class="st">"domtrait"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                        rank <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        warmup<span class="op">=</span><span class="fl">500</span>,</span>
<span>                        iter<span class="op">=</span><span class="fl">1500</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'ame_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000172 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.72 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 1500 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  150 / 1500 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  300 / 1500 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  450 / 1500 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  501 / 1500 [ 33%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  650 / 1500 [ 43%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 1500 [ 53%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  950 / 1500 [ 63%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1100 / 1500 [ 73%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1250 / 1500 [ 83%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 1500 [ 93%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1500 / 1500 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 6.138 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                12.136 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                18.274 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 100 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span></span>
<span><span class="va">nd_dom_1_mod_gofstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gofstats.html">gofstats</a></span><span class="op">(</span><span class="va">nd_dom_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Approx. completion</span></span>
<span><span class="co">#&gt; 25%</span></span>
<span><span class="co">#&gt; 50%</span></span>
<span><span class="co">#&gt; 75%</span></span>
<span><span class="co">#&gt; 100%</span></span>
<span><span class="va">nd_dom_1_mod_gofstats</span></span>
<span><span class="co">#&gt; p.sd.rowmeans   p.cycle.dep </span></span>
<span><span class="co">#&gt;    0.06333333    0.92000000</span></span>
<span></span>
<span><span class="va">nd_dom_1_mod_ppred</span> <span class="op">&lt;-</span> <span class="fu">compnet</span><span class="fu">::</span><span class="fu"><a href="../reference/postpredsamp.html">postpredsamp</a></span><span class="op">(</span><span class="va">nd_dom_1_mod</span><span class="op">)</span></span>
<span><span class="va">fpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">nd_dom_1_mod_ppred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">nd_dom_1_mod_dharma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">nd_dom_1_mod_ppred</span>,</span>
<span>                                observedResponse <span class="op">=</span> <span class="va">nd_dom_1_mod</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">both</span>,</span>
<span>                                fittedPredictedResponse <span class="op">=</span> <span class="va">fpr</span>,</span>
<span>                                integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html" class="external-link">testDispersion</a></span><span class="op">(</span><span class="va">nd_dom_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa nonparametric dispersion test via sd of residuals fitted vs.</span></span>
<span><span class="co">#&gt;  simulated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; dispersion = 1.032, p-value = 0.82</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testQuantiles.html" class="external-link">testQuantiles</a></span><span class="op">(</span><span class="va">nd_dom_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Test for location of quantiles via qgam</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  nd_dom_1_mod_dharma</span></span>
<span><span class="co">#&gt; p-value = 0.9295</span></span>
<span><span class="co">#&gt; alternative hypothesis: both</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testUniformity.html" class="external-link">testUniformity</a></span><span class="op">(</span><span class="va">nd_dom_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Asymptotic one-sample Kolmogorov-Smirnov test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput$scaledResiduals</span></span>
<span><span class="co">#&gt; D = 0.051474, p-value = 0.4575</span></span>
<span><span class="co">#&gt; alternative hypothesis: two-sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html" class="external-link">testZeroInflation</a></span><span class="op">(</span><span class="va">nd_dom_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa zero-inflation test via comparison to expected zeros with</span></span>
<span><span class="co">#&gt;  simulation under H0 = fitted model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; ratioObsSim = 0.99694, p-value = 0.99</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span></code></pre></div>
<p>Much better. Let’s have a quick look at our results and compare to
the model with no covariate adjustment:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarize_compnet.html">summarize_compnet</a></span><span class="op">(</span><span class="va">nd_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    Mean       2.5%      97.5%</span></span>
<span><span class="co">#&gt; intercept    -5.2410002 -6.1375622 -4.4895363</span></span>
<span><span class="co">#&gt; ndtrait_dist  0.8181314  0.5439445  1.1206381</span></span>
<span><span class="co">#&gt; ndtrait_sp    0.1212758 -0.1888162  0.4702241</span></span>
<span><span class="fu"><a href="../reference/summarize_compnet.html">summarize_compnet</a></span><span class="op">(</span><span class="va">nd_dom_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      Mean       2.5%      97.5%</span></span>
<span><span class="co">#&gt; intercept     -4.10914534 -4.9382643 -3.1477861</span></span>
<span><span class="co">#&gt; ndtrait_dist   1.32123703  0.9732955  1.6712420</span></span>
<span><span class="co">#&gt; domtrait_dist -1.80876748 -2.3813441 -1.3212013</span></span>
<span><span class="co">#&gt; ndtrait_sp     0.02545875 -0.3493046  0.3906324</span></span>
<span><span class="co">#&gt; domtrait_sp    0.22608018 -0.1818516  0.6134906</span></span></code></pre></div>
<p>The coefficient of the “ndtrait” distance term is greater in the new
model. This suggests our covariate adjustment strategy helped to
“unmask” the true effect of “ndtrait” on co-occurrence probability.
Let’s see if the scatterplots look much different:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_interaction.html">scatter_interaction</a></span><span class="op">(</span><span class="va">nd_1_mod</span>, xvar<span class="op">=</span><span class="st">"ndtrait"</span>, xlabel<span class="op">=</span><span class="st">"ND Trait"</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_interaction.html">scatter_interaction</a></span><span class="op">(</span><span class="va">nd_dom_1_mod</span>, xvar<span class="op">=</span><span class="st">"ndtrait"</span>, xlabel<span class="op">=</span><span class="st">"ND Trait"</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-16-2.png" width="576"></p>
<p>The effect is noticeably, if modestly, stronger in the new model that
incorporated covariate adjustment.</p>
</div>
<div class="section level2">
<h2 id="categorical-trait-model">Categorical trait model<a class="anchor" aria-label="anchor" href="#categorical-trait-model"></a>
</h2>
<p>Now let’s try a model with a categorical predictor, “ctrait”. We’ll
use rank 1, and we’ll skip the gofstats and DHARMa checks (which should
turn out fine) to keep things brief.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_1_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>                        spvars_cat_int<span class="op">=</span><span class="va">ex_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ctrait"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                        rank<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'ame_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000156 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.56 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 22.838 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                19.448 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                42.286 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 28 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre></div>
<p>Now let’s break down the output summary:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarize_compnet.html">summarize_compnet</a></span><span class="op">(</span><span class="va">c_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         Mean       2.5%      97.5%</span></span>
<span><span class="co">#&gt; intercept         -4.1894654 -5.2528039 -3.3565485</span></span>
<span><span class="co">#&gt; ctrait_int        -0.7068433 -1.1587157 -0.2763363</span></span>
<span><span class="co">#&gt; ctrait_b_dummy_sp -0.3048263 -1.1263334  0.5772639</span></span>
<span><span class="co">#&gt; ctrait_c_dummy_sp  0.6259212 -0.1696864  1.3646231</span></span></code></pre></div>
<p>After the intercept, we see the results for the interaction term.
This is a binary indicator that equals 1 when a species pair has the
same value of the categorical trait and equals 0 when they have
different values. We have strong evidence that the coefficient is
negative, which suggests having the same value of “ctrait” makes
co-occurrence less likely. This is the pattern we expect from
competitive niche differentiation.</p>
<p>The “dummy” rows are coefficients corresponding to species-level
effects for each category of “ctrait”. The first category, “a”, doesn’t
get a coefficient because it is automatically designated the “reference
category”. The effects for “b” and “c” can be viewed as contrasts
relative to the reference category.</p>
</div>
<div class="section level2">
<h2 id="phylogenetic-distance-model">Phylogenetic distance model<a class="anchor" aria-label="anchor" href="#phylogenetic-distance-model"></a>
</h2>
<p>Sometimes we might not have trait data, or we might not be sure which
traits make sense to use in our models. If we think phylogenetic
distance serves as a reasonable proxy for resource use overlap, then we
could use phylogenetic distance is a predictor in our ‘compnet’ model.
Let’s try this approach with the example data set.</p>
<p>First, we’ll load the phylogenetic distance data and have a look.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex_phylo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex_phylo</span><span class="op">)</span></span>
<span><span class="co">#&gt;   spAid spBid phylodist</span></span>
<span><span class="co">#&gt; 1   sp1   sp2  1.486439</span></span>
<span><span class="co">#&gt; 2   sp1   sp3  3.160156</span></span>
<span><span class="co">#&gt; 3   sp1   sp4  3.160968</span></span>
<span><span class="co">#&gt; 4   sp1   sp5  2.671681</span></span>
<span><span class="co">#&gt; 5   sp1   sp6  2.302756</span></span>
<span><span class="co">#&gt; 6   sp1   sp7  3.061021</span></span></code></pre></div>
<p>Rows represent species pairs. In addition to the phylodist column,
there are two columns containing unique species names for each pair.
These names must match the names in our presence-absence matrix.</p>
<p>Let’s build the model now. Phylogenetic distance is a
species-pair-level variable (not a species-level variable), so we’ll
tell buildcompnet() we want to use ‘ex_phylo’ with the ‘pairvars’
argument. We’ll start with rank 0.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phylo_0_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>                            pairvars<span class="op">=</span><span class="va">ex_phylo</span>,</span>
<span>                            warmup<span class="op">=</span><span class="fl">1000</span>,</span>
<span>                            iter<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'srm_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 8.3e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.83 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 2.065 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                1.966 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                4.031 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span></code></pre></div>
<p>Run our model checks:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gofstats.html">gofstats</a></span><span class="op">(</span><span class="va">phylo_0_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Approx. completion</span></span>
<span><span class="co">#&gt; 25%</span></span>
<span><span class="co">#&gt; 50%</span></span>
<span><span class="co">#&gt; 75%</span></span>
<span><span class="co">#&gt; 100%</span></span>
<span><span class="co">#&gt; p.sd.rowmeans   p.cycle.dep </span></span>
<span><span class="co">#&gt;    0.05666667    0.17333333</span></span>
<span></span>
<span><span class="va">phylo_0_mod_ppred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postpredsamp.html">postpredsamp</a></span><span class="op">(</span><span class="va">phylo_0_mod</span><span class="op">)</span></span>
<span><span class="va">fpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">phylo_0_mod_ppred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">phylo_0_mod_dharma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">phylo_0_mod_ppred</span>,</span>
<span>                                observedResponse <span class="op">=</span> <span class="va">phylo_0_mod</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">both</span>,</span>
<span>                                fittedPredictedResponse <span class="op">=</span> <span class="va">fpr</span>,</span>
<span>                                integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html" class="external-link">testDispersion</a></span><span class="op">(</span><span class="va">phylo_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa nonparametric dispersion test via sd of residuals fitted vs.</span></span>
<span><span class="co">#&gt;  simulated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; dispersion = 2.0643, p-value = 0.002</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testQuantiles.html" class="external-link">testQuantiles</a></span><span class="op">(</span><span class="va">phylo_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; qu = 0.75, log(sigma) = -2.457544 : outer Newton did not converge fully.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Test for location of quantiles via qgam</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  phylo_0_mod_dharma</span></span>
<span><span class="co">#&gt; p-value = 0.0002424</span></span>
<span><span class="co">#&gt; alternative hypothesis: both</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testUniformity.html" class="external-link">testUniformity</a></span><span class="op">(</span><span class="va">phylo_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Asymptotic one-sample Kolmogorov-Smirnov test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput$scaledResiduals</span></span>
<span><span class="co">#&gt; D = 0.06738, p-value = 0.1631</span></span>
<span><span class="co">#&gt; alternative hypothesis: two-sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html" class="external-link">testZeroInflation</a></span><span class="op">(</span><span class="va">phylo_0_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa zero-inflation test via comparison to expected zeros with</span></span>
<span><span class="co">#&gt;  simulation under H0 = fitted model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; ratioObsSim = 1.0386, p-value = 0.296</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span></code></pre></div>
<p>We’ve got problems with overdispersion and quantile deviations. Let’s
try again with ‘rank’ = 1.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phylo_1_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildcompnet.html">buildcompnet</a></span><span class="op">(</span>presabs<span class="op">=</span><span class="va">ex_presabs</span>,</span>
<span>                            pairvars<span class="op">=</span><span class="va">ex_phylo</span>,</span>
<span>                            rank<span class="op">=</span><span class="fl">1</span>,</span>
<span>                            warmup<span class="op">=</span><span class="fl">500</span>,</span>
<span>                            iter<span class="op">=</span><span class="fl">1500</span>,</span>
<span>                            adapt_delta<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'ame_binomial' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: Rejecting initial value:</span></span>
<span><span class="co">#&gt; Chain 1:   Log probability evaluates to log(0), i.e. negative infinity.</span></span>
<span><span class="co">#&gt; Chain 1:   Stan can't start sampling from this initial value.</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000154 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.54 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 1500 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  150 / 1500 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  300 / 1500 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  450 / 1500 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  501 / 1500 [ 33%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  650 / 1500 [ 43%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 1500 [ 53%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  950 / 1500 [ 63%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1100 / 1500 [ 73%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1250 / 1500 [ 83%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 1500 [ 93%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1500 / 1500 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 8.372 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                11.697 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                20.069 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 107 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 1 chains where the estimated Bayesian Fraction of Missing Information was low. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bfmi-low</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre></div>
<p>Run our model checks:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gofstats.html">gofstats</a></span><span class="op">(</span><span class="va">phylo_1_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Approx. completion</span></span>
<span><span class="co">#&gt; 25%</span></span>
<span><span class="co">#&gt; 50%</span></span>
<span><span class="co">#&gt; 75%</span></span>
<span><span class="co">#&gt; 100%</span></span>
<span><span class="co">#&gt; p.sd.rowmeans   p.cycle.dep </span></span>
<span><span class="co">#&gt;    0.07666667    0.52333333</span></span>
<span></span>
<span><span class="va">phylo_1_mod_ppred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postpredsamp.html">postpredsamp</a></span><span class="op">(</span><span class="va">phylo_1_mod</span><span class="op">)</span></span>
<span><span class="va">fpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">phylo_1_mod_ppred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">phylo_1_mod_dharma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">phylo_1_mod_ppred</span>,</span>
<span>                                observedResponse <span class="op">=</span> <span class="va">phylo_1_mod</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">both</span>,</span>
<span>                                fittedPredictedResponse <span class="op">=</span> <span class="va">fpr</span>,</span>
<span>                                integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html" class="external-link">testDispersion</a></span><span class="op">(</span><span class="va">phylo_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa nonparametric dispersion test via sd of residuals fitted vs.</span></span>
<span><span class="co">#&gt;  simulated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; dispersion = 0.84772, p-value = 0.668</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testQuantiles.html" class="external-link">testQuantiles</a></span><span class="op">(</span><span class="va">phylo_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Test for location of quantiles via qgam</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  phylo_1_mod_dharma</span></span>
<span><span class="co">#&gt; p-value = 0.02945</span></span>
<span><span class="co">#&gt; alternative hypothesis: both</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testUniformity.html" class="external-link">testUniformity</a></span><span class="op">(</span><span class="va">phylo_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Asymptotic one-sample Kolmogorov-Smirnov test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput$scaledResiduals</span></span>
<span><span class="co">#&gt; D = 0.064129, p-value = 0.2064</span></span>
<span><span class="co">#&gt; alternative hypothesis: two-sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html" class="external-link">testZeroInflation</a></span><span class="op">(</span><span class="va">phylo_1_mod_dharma</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  DHARMa zero-inflation test via comparison to expected zeros with</span></span>
<span><span class="co">#&gt;  simulation under H0 = fitted model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  simulationOutput</span></span>
<span><span class="co">#&gt; ratioObsSim = 1.0268, p-value = 0.512</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span></code></pre></div>
<p>Looks good! Let’s visualize results:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fixedeff_violins.html">fixedeff_violins</a></span><span class="op">(</span><span class="va">phylo_1_mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_pairvar.html">scatter_pairvar</a></span><span class="op">(</span><span class="va">phylo_1_mod</span>, xvar<span class="op">=</span><span class="st">"phylodist"</span>, xlabel<span class="op">=</span><span class="st">"Phylogenetic Distance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="compnet_workflow_files/figure-html/unnamed-chunk-25-1.png" width="576"></p>
<p>Not much of an effect. We can regard this as a warning that
phylogenetic distance may not always be an ideal proxy for resource use
overlap.</p>
</div>
<div class="section level2">
<h2 id="alternative-distributions">Alternative distributions<a class="anchor" aria-label="anchor" href="#alternative-distributions"></a>
</h2>
<p>As alternatives to the binomial likelihood, ‘compnet’ models can also
be built with <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html" class="external-link">beta-binomial</a>
or <a href="https://r-nimble.org/nimbleExamples/zero_inflated_poisson.html" class="external-link">zero-inflated
binomial</a> likelihoods by changing the ‘family’ argument in
buildcompnet() to “beta-binomial” or “zi_binomial”. These options can
sometimes help resolve the kinds of problems that ‘DHARMa’ checks
reveal, like overdispersion or zero-inflation. Before turning to fancy
solutions like these, it’s often worthwhile to rethink our choices of
predictor variables. However, that doesn’t always work, so it’s nice to
have fancier model structures available in case we need them.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle Rosenblad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
